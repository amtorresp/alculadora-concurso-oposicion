import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

const CalculadoraConcursoOposicion = () => {
  // Estado para la parte de examen
  const [correctas, setCorrectas] = useState('');
  const [incorrectas, setIncorrectas] = useState('');
  const [blanco, setBlanco] = useState('');
  const [puntuacionExamen, setPuntuacionExamen] = useState(null);
  const [errorExamen, setErrorExamen] = useState('');

  // Estado para la parte de méritos
  const [experienciaSNS, setExperienciaSNS] = useState('');
  const [experienciaOCDE, setExperienciaOCDE] = useState('');
  const [experienciaPrivada, setExperienciaPrivada] = useState('');
  const [formacionContinua, setFormacionContinua] = useState('');
  const [docenciaInvestigacion, setDocenciaInvestigacion] = useState('');

  const TOTAL_PREGUNTAS = 100;
  const PENALIZACION = 1/3;

  // Cálculo de la nota del examen
  const calcularNotaExamen = () => {
    const numCorrectas = parseInt(correctas) || 0;
    const numIncorrectas = parseInt(incorrectas) || 0;
    const numBlanco = parseInt(blanco) || 0;

    if (numCorrectas + numIncorrectas + numBlanco > TOTAL_PREGUNTAS) {
      setErrorExamen(`El total de preguntas no puede superar ${TOTAL_PREGUNTAS}`);
      setPuntuacionExamen(null);
      return;
    }

    if (numCorrectas < 0 || numIncorrectas < 0 || numBlanco < 0) {
      setErrorExamen('Los valores no pueden ser negativos');
      setPuntuacionExamen(null);
      return;
    }

    setErrorExamen('');
    const puntuacion = numCorrectas - (numIncorrectas * PENALIZACION);
    setPuntuacionExamen(puntuacion);
    return puntuacion;
  };

  // Cálculo de la puntuación total de méritos
  const calcularMeritos = () => {
    const expSNS = parseFloat(experienciaSNS) || 0;
    const expOCDE = parseFloat(experienciaOCDE) || 0;
    const expPrivada = parseFloat(experienciaPrivada) || 0;
    const formacion = parseFloat(formacionContinua) || 0;
    const docenciaInv = parseFloat(docenciaInvestigacion) || 0;

    return Math.min(100, expSNS + expOCDE + expPrivada + formacion + docenciaInv);
  };

  // Cálculo de la nota final
  const calcularNotaFinal = () => {
    const notaExamen = puntuacionExamen || 0;
    const notaMeritos = calcularMeritos();
    
    // 60% examen + 40% méritos
    return ((notaExamen * 0.6) + (notaMeritos * 0.4)).toFixed(2);
  };

  return (
    <Card className="w-full max-w-4xl mx-auto">
      <CardHeader>
        <CardTitle className="text-center">Calculadora de Concurso-Oposición</CardTitle>
      </CardHeader>
      <CardContent>
        <Tabs defaultValue="examen" className="space-y-4">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="examen">Examen (60%)</TabsTrigger>
            <TabsTrigger value="meritos">Méritos (40%)</TabsTrigger>
          </TabsList>

          <TabsContent value="examen" className="space-y-4">
            <div className="space-y-4">
              <div>
                <Label htmlFor="correctas">Preguntas Correctas:</Label>
                <Input
                  id="correctas"
                  type="number"
                  value={correctas}
                  onChange={(e) => setCorrectas(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="100"
                />
              </div>

              <div>
                <Label htmlFor="incorrectas">Preguntas Incorrectas:</Label>
                <Input
                  id="incorrectas"
                  type="number"
                  value={incorrectas}
                  onChange={(e) => setIncorrectas(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="100"
                />
              </div>

              <div>
                <Label htmlFor="blanco">Preguntas en Blanco:</Label>
                <Input
                  id="blanco"
                  type="number"
                  value={blanco}
                  onChange={(e) => setBlanco(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="100"
                />
              </div>

              <div className="text-sm text-gray-500">
                <ul className="list-disc pl-4 space-y-1">
                  <li>Correctas: +1 punto</li>
                  <li>Incorrectas: -{PENALIZACION} puntos</li>
                  <li>En blanco: 0 puntos</li>
                </ul>
              </div>

              {errorExamen && (
                <div className="text-red-500 text-sm">
                  {errorExamen}
                </div>
              )}

              <button 
                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                onClick={calcularNotaExamen}
              >
                Calcular Nota Examen
              </button>

              {puntuacionExamen !== null && !errorExamen && (
                <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                  <div className="text-center">
                    <div className="font-semibold">Nota del Examen:</div>
                    <div className="text-2xl font-bold text-blue-600">
                      {puntuacionExamen.toFixed(2)}
                    </div>
                  </div>
                </div>
              )}
            </div>
          </TabsContent>

          <TabsContent value="meritos" className="space-y-4">
            <div className="space-y-4">
              <div>
                <Label htmlFor="experienciaSNS">
                  Experiencia en SNS (máx. 55 puntos):
                </Label>
                <Input
                  id="experienciaSNS"
                  type="number"
                  value={experienciaSNS}
                  onChange={(e) => setExperienciaSNS(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="55"
                />
              </div>

              <div>
                <Label htmlFor="experienciaOCDE">
                  Experiencia en OCDE (máx. 10 puntos):
                </Label>
                <Input
                  id="experienciaOCDE"
                  type="number"
                  value={experienciaOCDE}
                  onChange={(e) => setExperienciaOCDE(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="10"
                />
              </div>

              <div>
                <Label htmlFor="formacionContinua">
                  Formación (máx. 20 puntos):
                </Label>
                <Input
                  id="formacionContinua"
                  type="number"
                  value={formacionContinua}
                  onChange={(e) => setFormacionContinua(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="20"
                />
              </div>

              <div>
                <Label htmlFor="docenciaInvestigacion">
                  Docencia e Investigación (máx. 25 puntos):
                </Label>
                <Input
                  id="docenciaInvestigacion"
                  type="number"
                  value={docenciaInvestigacion}
                  onChange={(e) => setDocenciaInvestigacion(e.target.value)}
                  placeholder="0"
                  min="0"
                  max="25"
                />
              </div>

              <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                <div className="text-center">
                  <div className="font-semibold">Total Méritos:</div>
                  <div className="text-2xl font-bold text-blue-600">
                    {calcularMeritos().toFixed(2)}
                  </div>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>

        <div className="mt-8 p-6 bg-gray-100 rounded-lg">
          <div className="text-center">
            <div className="text-lg font-semibold mb-2">Puntuación Final</div>
            <div className="text-3xl font-bold text-blue-600">
              {calcularNotaFinal()}
            </div>
            <div className="text-sm text-gray-500 mt-2">
              (60% Examen + 40% Méritos)
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default CalculadoraConcursoOposicion;
